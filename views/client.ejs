<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Page - <%= client.fullname %></title>
    <!-- Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/styles/css/client.css">
    <link rel="stylesheet" href="/styles/css/setup/vars.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>

<body>
    <main class="client">
        <div class="client_details">
            <div class="personal_data">
                <h1 class="headline"><i class="bi bi-file-earmark-person-fill"></i> Personal Data</h1>
                <hr>
                <img class="user-image" src="/styles/imgs/clients/<%= client.imgURL %>" alt="User photo">
                <hr>
                <div class="information">
                    <h3>Name</h3>
                    <p><%= client.fullname %></p>
                    <h3>User Name</h3>
                    <p><%= client.username %></p>
                    <h3>Total Spent</h3>
                    <p>$<%= client.spent %></p>
                    <hr>
                </div>
                <a href="/login/logout">
                    <button class="btn_client">Logout <i class="bi bi-box-arrow-right"></i></button>
                </a>
            </div>
        </div>

        <div class="yourhistory">
            <ul class="nav nav-pills">
                <li class="nav-item"><a class="nav-link active" data-bs-toggle="pill" href="#tab3-1">Your Favorite Items</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="pill" href="#tab3-2">Your Reservation History</a></li>
            </ul>
            <hr class="history-line">
            <div class="tab-content mt-0 mt-md-5" id="items-history">
                <div class="tab-pane fade show active" id="tab3-1">
                    <% if (client.faveItems && client.faveItems.length > 0) { %>
                        <div class="items-header">
                            <h2>Favorite Items | <%= client.faveItems.length %></h2>
                        </div>
                        <span class="favorite_list">
                            <% client.faveItems.forEach(item => { %>
                                <div class="product">
                                    <img src="<%= item.srcImg && item.srcImg[0] && item.srcImg[0].startsWith('data:') ? item.srcImg[0] : '/styles/imgs/products/' + (item.srcImg ? item.srcImg[0] : 'default-image.png') %>"
                                         alt="<%= item.title %> image" class="product-image">
                                    <span class="product-name"><b>Product ID: <%= item._id %></b></span>
                                    <span class="product-title"><b>Title: <%= item.title %></b></span>
                                    <a href="/products/product/<%= item._id %>" class="btn btn-primary mt-2">See Product</a>
                                </div>
                            <% }) %>
                        </span>
                    <% } else { %>
                        <div class="no-favorite-items">
                            <p>No favorite items yet</p>
                        </div>
                    <% } %>
                </div>

                <div class="tab-pane fade" id="tab3-2">
                    <% if (client.orders && client.orders.length > 0) { %>
                        <% client.orders.forEach((orderList, index) => { %>
                            <div class="items-header">
                                <h2>Order <%= index + 1 %> | Items: <%= orderList.length %></h2>
                            </div>
                            <div class="order-list">
                                <% orderList.forEach((order, orderIndex) => { %>
                                    <% if (orderIndex % 4 === 0) { %>
                                        <div class="row">
                                    <% } %>
                                    <div class="col-md-3">
                                        <div class="product">
                                            <% if (order.type === 'ticket') { %>
                                                <img src="<%= order.details.opImg && order.details.opImg.startsWith('data:') ? order.details.opImg : '/styles/imgs/tickets/' + (order.details.opImg ? order.details.opImg : 'default-image.png') %>"
                                                     alt="<%= order.details.title %> image" class="product-image">
                                            <% } else { %>
                                                <img src="<%= order.details.srcImg && order.details.srcImg[0] && order.details.srcImg[0].startsWith('data:') ? order.details.srcImg[0] : '/styles/imgs/products/' + (order.details.srcImg ? order.details.srcImg[0] : 'default-image.png') %>"
                                                     alt="<%= order.details.title %> image" class="product-image">
                                            <% } %>
                                            <span class="product-name"><b><%= order.type.charAt(0).toUpperCase() + order.type.slice(1) %> ID: <%= order.id %></b></span>
                                            <span class="product-title"><b>Title: <%= order.details.title %></b></span>
                                            <% if (order.type === 'ticket') { %>
                                                <span class="product-date"><b>Date: <%= new Date(order.details.date).toLocaleDateString() %></b></span>
                                            <% } %>
                                            <a href="/<%= order.type %>s/<%= order.type %>/<%= order.id %>" class="btn btn-primary mt-2">See <%= order.type.charAt(0).toUpperCase() + order.type.slice(1) %></a>
                                            <div class="product-details">
                                                <p>Size: <%= order.size %></p>
                                                <p>Price: $<%= order.details.price %></p>
                                            </div>
                                        </div>
                                    </div>
                                    <% if ((orderIndex + 1) % 4 === 0 || orderIndex === orderList.length - 1) { %>
                                        </div>
                                    <% } %>
                                <% }) %>
                            </div>
                        <% }) %>
                    <% } else { %>
                        <div class="no-orders">
                            <p>No orders yet</p>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </main>

    <!-- Libraries -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
    <script src="/js/client.js"></script>
</body>

</html>
